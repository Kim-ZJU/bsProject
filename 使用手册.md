# 使用手册

## 1. 第三方依赖清单

- 前端

  React

- 后端

  Node.js + express

- 数据库

  MongoDB + mongoose

- 服务器

  EMQX——开源物联网MQTT 服务器

## 2. 配置命令

前置：已安装Homebrew

1. 安装Node.js：`brew install node`
2. 安装MongoDB：`brew tap mongodb/brew`  `brew install mongodb-community`
3. 搭建mqtt服务器EMQX：`brew tap emqx/emqx` `brew install emqx`

## 3. CLI启动本应用

CLI启动本应用的步骤如下：

1. 启动MongoDB

   Mac的可能命令是:

   ​	`source .bash_profile`

   ​	`cd /usr/local/mongodb/bin`

   ​	`./mongod`

2. 到后端项目`bsProject`文件夹下，输入命令`npm install && node bin/www`（由于本应用的后端用的是Node.js + express，此时项目会自动在MongoDB中创建一个数据库及相应表，因此本应用不需要建库建表文件。）

3. 到前端项目`bs-antd`文件夹下，输入命令`yarn install && yarn start`

此时，浏览器会自动打开本应用的web网站；不过，由于还没有启动mqtt服务器，所以数据库中还没有数据，只能在“我的”界面进行一些基础操作，如注册、登录用户、创建设备、修改创建的设备信息，其他界面能正常显示但没有数据。

接下来CLI启动EMQX服务器并连接：

1. 在`bsProject`目录下输入`emqx start && node mqtt.js`，此时终端会输出服务器连接成功的提示
2. 打开新的终端窗口，启动测试程序，1中的终端就会打印订阅的主题

此时，再次点击“首页”、“地图”、“查询”界面，即可看到图表统计信息、地图上的历史轨迹、设备上报数据的查询统计信息。

## 4. 详细使用

1. 用户注册：输入大于6字节的用户名和密码，输入格式正确的email，点击注册；输入为空或其他错误都无法注册成功，会有提示。
2. 用户登录：输入注册的用户名和密码即可登录；未经注册的用户名不能登录。
3. 创建设备：点击“我的”界面，输入设备ID和设备名称即可创建设备；如果输入的设备ID已存在，则不能成功创建。
4. 修改设备信息：输入要修改的设备ID，选择要修改的设备属性，输入修改后的属性，点击提交即可修改；输入的设备ID或未选择属性则不能修改成功。
5. 查询设备上报数据：点击“查询”界面，选择要查询的设备，下方即会以卡片的形式展示该设备的所有上报数据，并显示统计信息；如果选择的设备暂时没有上报数据，会有输出提示。
6. 地图展示设备信息：点击“地图”界面，即可查看用户名下所有设备的位置和历史轨迹，红色设备为告警设备，蓝色设备为正常运行设备。
7. 首页查看图表统计信息：点击“首页”界面，即可查看用户名下的设备总量、在线设备量、接受数据量、告警设备量。
8. 本网站用ant design mobile实现，所以同一局域网内的手机也可在内置的浏览器上查看。

